{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?7e02","webpack:///./src/assets/logo-title.svg","webpack:///./src/components/Editor.vue?8977","webpack:///./src/App.vue?62e2","webpack:///./src/components/Index.vue?1571","webpack:///src/components/Index.vue","webpack:///./src/components/Index.vue?d617","webpack:///./src/components/Index.vue?24bf","webpack:///./src/components/Editor.vue?d661","webpack:///./src/utils/urls.js","webpack:///./src/utils/maskData.js","webpack:///./src/utils/geometry.js","webpack:///./src/utils/maskHelper.js","webpack:///./src/utils/faceApiUtil.js","webpack:///./src/utils/stickerCanvas.js","webpack:///src/components/Editor.vue","webpack:///./src/components/Editor.vue?145f","webpack:///./src/components/Editor.vue?7a29","webpack:///./src/components/Export.vue?be2c","webpack:///src/components/Export.vue","webpack:///./src/components/Export.vue?90b3","webpack:///./src/components/Export.vue?d158","webpack:///src/App.vue","webpack:///./src/App.vue?1160","webpack:///./src/App.vue?bff9","webpack:///./src/store/index.js","webpack:///./src/main.js","webpack:///./src/assets/example.png","webpack:///./src/components/Export.vue?9042","webpack:///./src/components/Index.vue?71bc"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","attrs","_m","directives","rawName","nav","expression","on","navTo","currentFileId","_e","staticRenderFns","_v","ref","staticClass","wide","domProps","_s","space","addImg","methods","inputDOM","files","file","id","Date","getTime","$store","commit","fileInfo","$emit","mounted","$refs","index","clientWidth","component","class","loading","resumeMask","_l","maskData","$event","changeMask","baseUrl","reupload","save","maskBaseUrl","modelBaseUrl","urls","masks","width","height","side","leftPoint","rightPoint","bottomPoint","getMidPoint","p1","p2","x1","y1","x2","y2","makeLine","pointDistance","Math","sqrt","pointLineDistance","x","y","A","B","C","abs","makePerpendicularLine","getCrossPointOfTwoLines","l1","l2","A1","B1","C1","A2","B2","C2","denominator","getPerpendicularPoint","getAngle","center","sp","ep","cx","cy","sx","sy","ex","ey","f_c_x","f_c_y","s_c_x","s_c_y","angle","acos","vecX","vecY","PI","cvt","maskImageSrc","findMask","lp","rp","bp","minDistance","Number","MAX_VALUE","minData","filter","forEach","dm12","geometry","dm13","dm03","dm01","rate","x0","y0","pline","assign","overturn","transform","computeTransform","sp1","sp2","sp3","ep1","ep2","ep3","stickerWidth","stickerHeight","de12","xScale","yScale","centerX","centerY","sign","wearAMaskAfterFaceDetection","canvasModel","realImgInfo","points","landmarks","positions","nosePoint","maskInfo","mask","imgOriginalWidth","detection","imageWidth","imgOriginalHeight","imageHeight","wearAMaskNormally","xRate","yRate","getMaskImageSrc","url","layers","removeItem","addPhoto","position","chooseItem","wearAMaskAsAFool","newMask","oldRect","rect","callback","self","xhr","XMLHttpRequest","onload","URL","createObjectURL","response","open","responseType","send","modelUrl","detectPic","img","onFailed","failed","onLoadErr","Promise","all","faceapi","faceLandmark68Net","loadFromUri","catch","ssdMobilenetv1","then","options","minConfidence","withFaceLandmarks","console","log","maskHelper","drawFaceLandmarks","canvas","ctx","getContext","e","fillStyle","fillRect","font","fillText","getVectorLength","v1","v2","getDocPosition","element","eleCom","document","querySelector","offsetLeft","offsetTop","parent","offsetParent","Border","cPoints","reduce","a","b","rPoint","draw","context","c_x","c_y","translate","rotate","beginPath","globalAlpha","lineWidth","strokeStyle","moveTo","lineTo","stroke","closePath","pointList","concat","item","arc","fill","restore","point","status","r_point","rotatePoint","d_point","map","c_point","pow","Rect","getPoints","h","w","vector","_x","_y","getCenter","parseFloat","_angle","_x_x","sin","_y_x","cos","n_x","_x_y","_y_y","n_y","tan","atan","pointZoom","_angles","n_tan","p3","p4","ratio1","ratio2","Photo","image","canEdit","imgInput","onLoad","isLoad","Image","prepare","init","src","complete","scale","drawImage","StickerCanvas","target","beforeLoading","afterLoading","getElementById","loadingLayerCount","border","current","initEvent","clear","add","lyr","setTimeout","addEventListener","p_x","pageX","p_y","pageY","offsetWidth","selectPhoto","move","event","m_x","m_y","e_point","isNaN","zoom","removeEventListener","preventDefault","touches","command","rectOptions","isPointInSkeletion","reverse","c_index","isPointInRect","createElement","bg","xOffset","yOffset","fg","toDataURL","setTransform","clearRect","refresh","cen","first","second","props","fileId","editor","loadImg","remove","clientHeight","maskStore","control","canvasContainer","appendChild","reader","readAsDataURL","imgWidth","imgHeight","imgX","imgY","faceApiUtil","watch","v","state","userImgInfo","style","imgUrl","backToEditor","backToIndex","imgStyle","created","left","top","export","components","Index","Editor","Export","where","Vue","use","Vuex","getters","actions","mutations","setUserImgInfo","setEditor","Store","config","productionTip","store","render","App","$mount"],"mappings":"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","file":"js/app.8429b7fd.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/wear-a-mask/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"","module.exports = __webpack_public_path__ + \"img/logo-title.02b87219.svg\";","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Editor.vue?vue&type=style&index=0&id=d357fdec&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Editor.vue?vue&type=style&index=0&id=d357fdec&scoped=true&lang=css&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_vm._m(0),_c('div',{attrs:{\"id\":\"contentContainer\"}},[_c('div',{attrs:{\"id\":\"content\"}},[_c('Index',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.nav=='index'),expression:\"nav=='index'\"}],on:{\"navTo\":_vm.navTo}}),_c('Editor',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.nav=='editor'),expression:\"nav=='editor'\"}],attrs:{\"fileId\":_vm.currentFileId},on:{\"navTo\":_vm.navTo}}),(_vm.nav=='export')?_c('Export',{on:{\"navTo\":_vm.navTo}}):_vm._e()],1)])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"header\"}},[_c('img',{attrs:{\"id\":\"logo\",\"src\":require(\"./assets/logo-title.svg\")}}),_c('a',{attrs:{\"id\":\"forkMe\",\"href\":\"https://github.com/zamhown/wear-a-mask\"}},[_vm._v(\"Fork me on GitHub!\")])])}]\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"index\"},[_vm._m(0),_c('p',{staticClass:\"title\"},[_vm._v(\"疫情当前，有罩才稳\")]),_c('p',{staticClass:\"slogan\"},[(!_vm.wide)?_c('span',{domProps:{\"innerHTML\":_vm._s(_vm.space)}}):_vm._e(),_vm._v(\"给社交网络头像戴上口罩，\"),(!_vm.wide)?_c('br'):_vm._e(),(!_vm.wide)?_c('span',{domProps:{\"innerHTML\":_vm._s(_vm.space)}}):_vm._e(),_vm._v(\"提醒更多人关注身体健康。\")]),_c('div',{staticClass:\"upload\"},[_c('span',[_vm._v(\"选择图片\")]),_c('input',{ref:\"inputer\",staticClass:\"upload\",attrs:{\"type\":\"file\",\"accept\":\"image/*\"},on:{\"change\":_vm.addImg}})]),_c('p',{staticClass:\"description\"},[_vm._v(\"此页面可以在你的头像上自动P上口罩，你还可以对口罩的位置和大小进行编辑。\")]),_c('p',{staticClass:\"description\"},[_vm._v(\"人脸检测算法基于SSD MobileNet V1神经网络模型，无需上传图片，也不会保留任何数据。\")])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('p',[_c('img',{staticClass:\"example\",attrs:{\"src\":require(\"../assets/example.png\")}})])}]\n\nexport { render, staticRenderFns }","<template>\n  <div ref=\"index\">\n    <p><img class=\"example\" src=\"../assets/example.png\"></p>\n    <p class=\"title\">疫情当前，有罩才稳</p>\n    <p class=\"slogan\"><span v-if=\"!wide\" v-html=\"space\"></span>给社交网络头像戴上口罩，<br v-if=\"!wide\"><span v-if=\"!wide\" v-html=\"space\"></span>提醒更多人关注身体健康。</p>\n    <div class=\"upload\">\n      <span>选择图片</span>\n      <input type=\"file\" class=\"upload\" @change=\"addImg\" ref=\"inputer\" accept=\"image/*\" />\n    </div>\n    <p class=\"description\">此页面可以在你的头像上自动P上口罩，你还可以对口罩的位置和大小进行编辑。</p>\n    <p class=\"description\">人脸检测算法基于SSD MobileNet V1神经网络模型，无需上传图片，也不会保留任何数据。</p>\n  </div>\n</template>\n\n<script>\n/* eslint-disable no-console */\n\nexport default {\n  data() {\n    return {\n      space: '　',\n      wide: false\n    }\n  },\n  methods: {\n    addImg() {\n      let inputDOM = this.$refs.inputer;\n      // 通过DOM取文件数据\n      if (inputDOM.files.length == 1) {\n        /*\n        let size = Math.floor(inputDOM.files[0].size / 1024);\n        if (size > 5 * 1024 * 1024) {\n          alert('请选择5M以内的图片！');\n          return false;\n        }\n        */\n        const fileInfo = {\n          file: inputDOM.files[0],\n          id: new Date().getTime()\n        };\n        this.$store.commit('setUserImgInfo', fileInfo);\n        this.$emit('navTo', 'editor', fileInfo.id);\n      }\n    }\n  },\n  mounted () {\n    this.wide = this.$refs.index.clientWidth > 500;\n  }\n}\n</script>\n\n<style scoped>\n.example {\n  width: 100%;\n  max-width: 400px;\n}\n.title {\n  font-size: 20px;\n  font-weight: bolder;\n  line-height: 35px;\n  color: #ff664d;\n  letter-spacing: 4px;\n}\n.slogan {\n  font-size: 18px;\n  line-height: 28px;\n  color: #ff8571;\n  letter-spacing: 2px;\n}\n.description {\n  color: #888;\n  margin: 0px 15px 15px 15px;\n  text-align: justify;\n  letter-spacing: 1px;\n}\n.upload {\n  position: relative;\n  width: 160px;\n  height: 60px;\n  margin: 20px auto;\n  background: #ff8571;\n  border-radius: 30px;\n  font-size: 16px;\n  box-shadow: 0px 0px 10px #ccc;\n}\n.upload:hover {\n  background: #ff664d;\n}\n.upload span{\n  display: block;\n  width: 100%;\n  height: 100%;\n  color: white;\n  font-size: 20px;\n  line-height: 60px;\n}\n.upload input {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  margin: 0px;\n  width: 160px;\n  height: 60px;\n  opacity: 0;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Index.vue?vue&type=template&id=410321b3&scoped=true&\"\nimport script from \"./Index.vue?vue&type=script&lang=js&\"\nexport * from \"./Index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Index.vue?vue&type=style&index=0&id=410321b3&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"410321b3\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"editor\",attrs:{\"id\":\"editor\"}},[_c('div',{class:{'loading': _vm.loading},attrs:{\"id\":\"editorUI\"}},[_c('div',{ref:\"canvasContainer\"}),_c('button',{attrs:{\"id\":\"resumeBtn\"},on:{\"click\":_vm.resumeMask}},[_vm._v(\"重置\")]),_c('div',{ref:\"maskStore\",attrs:{\"id\":\"maskStore\"}},[_c('p',{staticClass:\"title\"},[_vm._v(\"更换口罩\")]),_c('div',{staticClass:\"list\"},[_c('ul',_vm._l((_vm.maskData.masks),function(m){return _c('li',{key:m.name,on:{\"click\":function($event){return _vm.changeMask(m)}}},[_c('img',{attrs:{\"src\":_vm.maskData.baseUrl + m.name}})])}),0)])]),_c('div',{ref:\"control\",staticClass:\"control\"},[_c('button',{attrs:{\"id\":\"reuploadBtn\"},on:{\"click\":_vm.reupload}},[_vm._v(\"重选图片\")]),_c('button',{attrs:{\"id\":\"saveBtn\"},on:{\"click\":_vm.save}},[_vm._v(\"保存图片\")])])]),(_vm.loading)?_c('div',{attrs:{\"id\":\"loading\"}},[_vm._m(0)]):_vm._e()])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('p',[_c('b',[_vm._v(\"正在进行人脸检测，请稍等……\")]),_c('br'),_vm._v(\" 由于算法全程在浏览器运行， \"),_c('br'),_vm._v(\" 运算速度可能取决于设备性能。 \")])])}]\n\nexport { render, staticRenderFns }","export default {\r\n    maskBaseUrl: 'https://zamhown.github.io/wear-a-mask/masks/',\r\n    modelBaseUrl: 'https://zamhown.github.io/wear-a-mask/weights'\r\n}","import urls from './urls';\r\n\r\nexport default {\r\n    baseUrl: urls.maskBaseUrl,\r\n    // 数据要求：leftPoint和rightPoint必须同高\r\n    // side：0正面，1左侧面，2右侧面\r\n    masks: [\r\n        {\r\n            name: \"n1.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [4, 90],\r\n            rightPoint: [248, 90],\r\n            bottomPoint: [130, 216]\r\n        },\r\n        {\r\n            name: \"n2.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [3, 71],\r\n            rightPoint: [255, 71],\r\n            bottomPoint: [129, 231]\r\n        },\r\n        {\r\n            name: \"n3.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [6, 81],\r\n            rightPoint: [249, 81],\r\n            bottomPoint: [131, 246]\r\n        },\r\n        {\r\n            name: \"n4.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [4, 69],\r\n            rightPoint: [252, 69],\r\n            bottomPoint: [137, 234]\r\n        },\r\n        {\r\n            name: \"n5.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [13, 47],\r\n            rightPoint: [248, 47],\r\n            bottomPoint: [163, 222]\r\n        },\r\n        {\r\n            name: \"n6.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [7, 56],\r\n            rightPoint: [251, 56],\r\n            bottomPoint: [108, 243]\r\n        },\r\n        {\r\n            name: \"n7.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [7, 78],\r\n            rightPoint: [247, 78],\r\n            bottomPoint: [123, 230]\r\n        },\r\n        {\r\n            name: \"n8.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [17, 77],\r\n            rightPoint: [248, 77],\r\n            bottomPoint: [131, 250]\r\n        },\r\n        {\r\n            name: \"n9.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [61, 156],\r\n            rightPoint: [223, 156],\r\n            bottomPoint: [137, 247]\r\n        },\r\n        {\r\n            name: \"n10.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 1,\r\n            leftPoint: [8, 100],\r\n            rightPoint: [225, 100],\r\n            bottomPoint: [92, 240]\r\n        },\r\n        {\r\n            name: \"n11.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 1,\r\n            leftPoint: [37, 86],\r\n            rightPoint: [221, 86],\r\n            bottomPoint: [80, 243]  // 假点，为了避免戴在正脸上\r\n        },\r\n        {\r\n            name: \"n12.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [8, 65],\r\n            rightPoint: [250, 65],\r\n            bottomPoint: [127, 242]\r\n        },\r\n        {\r\n            name: \"n13.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [10, 86],\r\n            rightPoint: [249, 86],\r\n            bottomPoint: [126, 244]\r\n        },\r\n        {\r\n            name: \"n14.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [10, 97],\r\n            rightPoint: [246, 97],\r\n            bottomPoint: [122, 210]\r\n        },\r\n        {\r\n            name: \"n15.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 2,\r\n            leftPoint: [3, 63],\r\n            rightPoint: [209, 63],\r\n            bottomPoint: [143, 241]\r\n        },\r\n        {\r\n            name: \"n16.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [11, 88],\r\n            rightPoint: [240, 88],\r\n            bottomPoint: [123, 210]\r\n        },\r\n        {\r\n            name: \"n17.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [9, 59],\r\n            rightPoint: [236, 59],\r\n            bottomPoint: [95, 248]\r\n        },\r\n        {\r\n            name: \"n18.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [13, 93],\r\n            rightPoint: [244, 93],\r\n            bottomPoint: [133, 226]\r\n        },\r\n        {\r\n            name: \"n19.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [15, 45],\r\n            rightPoint: [247, 45],\r\n            bottomPoint: [165, 247]\r\n        },\r\n        {\r\n            name: \"n20.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [8, 77],\r\n            rightPoint: [246, 77],\r\n            bottomPoint: [127, 242]\r\n        },\r\n        {\r\n            name: \"n21.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [11, 65],\r\n            rightPoint: [246, 65],\r\n            bottomPoint: [129, 251]\r\n        },\r\n        {\r\n            name: \"n22.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [31, 107],\r\n            rightPoint: [215, 107],\r\n            bottomPoint: [123, 232]\r\n        },\r\n        {\r\n            name: \"n23.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [19, 93],\r\n            rightPoint: [239, 93],\r\n            bottomPoint: [125, 232]\r\n        },\r\n        {\r\n            name: \"n24.png\",\r\n            width: 256,\r\n            height: 256,\r\n            side: 0,\r\n            leftPoint: [19, 72],\r\n            rightPoint: [242, 72],\r\n            bottomPoint: [154, 251]\r\n        },\r\n    ]\r\n};","export default {\r\n    // 求两点的中点\r\n    getMidPoint(p1, p2) {\r\n        const [x1, y1] = p1;\r\n        const [x2, y2] = p2;\r\n        return [(x1 + x2) / 2, (y1 + y2) / 2];\r\n    },\r\n    // 已知两点求直线解析式Ax+By+C=0\r\n    makeLine(p1, p2) {\r\n        const [x1, y1] = p1;\r\n        const [x2, y2] = p2;\r\n        return [\r\n            y1 - y2,\r\n            x2 - x1,\r\n            (x1 - x2) * y2 + (y2 - y1) * x2\r\n        ];\r\n    },\r\n    // 两点距离\r\n    pointDistance(p1, p2) {\r\n        const [x1, y1] = p1;\r\n        const [x2, y2] = p2;\r\n        return Math.sqrt((x1 - x2) * (x1 - x2) + (y1 - y2) * (y1 - y2));\r\n    },\r\n    // 已知一点和直线解析式Ax+By+C=0，求点到直线的距离\r\n    pointLineDistance(p, l) {\r\n        const [x, y] = p;\r\n        const [A, B, C] = l;\r\n        return Math.abs(A * x + B * y + C) / Math.sqrt(A * A + B * B);\r\n    },\r\n    // 已知直线解析式Ax+By+C=0和垂线上一点，求过该点的垂线的解析式\r\n    makePerpendicularLine(l, p) {\r\n        const [A, B] = l;\r\n        const [x, y] = p;\r\n        return [\r\n            -B,\r\n            A,\r\n            B * x - A * y\r\n        ];\r\n    },\r\n    // 求两直线的交点\r\n    getCrossPointOfTwoLines(l1, l2) {\r\n        const [A1, B1, C1] = l1;\r\n        const [A2, B2, C2] = l2;\r\n        const denominator = A1 * B2 - A2 * B1;\r\n        return [(B1 * C2 - B2 * C1) / denominator,\r\n            (A2 * C1 - A1 * C2) / denominator];\r\n    },\r\n    // 已知一点和直线解析式Ax+By+C=0，求点到直线的垂线与直线的交点\r\n    getPerpendicularPoint(l, p) {\r\n        return this.getCrossPointOfTwoLines(l, this.makePerpendicularLine(l, p));\r\n    },\r\n    // 根据旋转中心点和一点的初、末坐标，求旋转角度\r\n    getAngle(center, sp, ep) {\r\n        const [cx, cy] = center;\r\n        const [sx, sy] = sp;\r\n        const [ex, ey] = ep;\r\n        const f_c_x = sx - cx;\r\n        const f_c_y = cy - sy;\r\n        const s_c_x = ex - cx;\r\n        const s_c_y = cy - ey;\r\n        const c = Math.sqrt(f_c_x * f_c_x + f_c_y * f_c_y)\r\n            * Math.sqrt(s_c_x * s_c_x + s_c_y * s_c_y);\r\n        if (c === 0) return -1;\r\n        const angle = Math.acos((f_c_x * s_c_x + f_c_y * s_c_y) / c);\r\n        const [vecX, vecY] = [cx - ex, cy - ey];\r\n        // 第一象限\r\n        if (vecX < 0 && vecY < 0) {\r\n            return angle;\r\n        }\r\n        // 第二象限\r\n        if (vecX < 0 && vecY > 0) {\r\n            return angle;\r\n        }\r\n        // 第三象限\r\n        if (vecX > 0 && vecY < 0) {\r\n            return 2 * Math.PI - angle;\r\n        }\r\n        // 第四象限\r\n        if (vecX > 0 && vecY > 0) {\r\n            return 2 * Math.PI - angle;\r\n        }\r\n        return null;\r\n    }\r\n}","/* eslint-disable no-console */\r\nimport maskData from \"./maskData\";\r\nimport geometry from \"./geometry\";\r\nimport { Object } from \"core-js\";\r\n\r\nfunction cvt(p) {\r\n    return [p.x, p.y];\r\n}\r\n\r\nexport default {\r\n    // 口罩图像缓存\r\n    maskImageSrc: {},\r\n    // 挑选合适的口罩\r\n    findMask(lp, rp, bp, side) {\r\n        // 将口罩放缩，左右两点和脸部左右两点重合，计算底部点的距离\r\n        let minDistance = Number.MAX_VALUE;\r\n        let minData = null;\r\n        maskData.masks.filter(m => (m.side == 0 && side == 0) || m.side * side > 0).forEach(m => {\r\n            const dm12 = geometry.pointDistance(m.leftPoint, m.rightPoint);\r\n            const dm13 = geometry.pointDistance(m.leftPoint, m.bottomPoint);\r\n            const dm03 = geometry.pointLineDistance(m.bottomPoint, geometry.makeLine(m.leftPoint, m.rightPoint));\r\n            const dm01 = Math.sqrt(dm13 * dm13 - dm03 * dm03);\r\n            const rate = dm01 / dm12;\r\n            const [x1, y1] = lp;\r\n            const [x2, y2] = rp;\r\n            // 正常\r\n            if ((m.side == 0 && side == 0) || m.side == side) {\r\n                let [x0, y0] = [x1 + (x2 - x1) * rate, y1 + (y2 - y1) * rate];\r\n                let pline = geometry.makePerpendicularLine(geometry.makeLine(lp, rp), [x0, y0]);\r\n                let d = geometry.pointLineDistance(bp, pline);\r\n                if (minDistance > d) {\r\n                    minDistance = d;\r\n                    minData = Object.assign({\r\n                        overturn: false,\r\n                        transform: this.computeTransform(\r\n                            m.leftPoint, m.rightPoint, m.bottomPoint,\r\n                            lp, rp, geometry.getPerpendicularPoint(pline, bp),\r\n                            m.width, m.height)\r\n                    }, m);\r\n                }\r\n            }\r\n            // 翻转\r\n            if ((m.side == 0 && side == 0) || m.side != side) {\r\n                let [x0, y0] = [x2 + (x1 - x2) * rate, y2 + (y1 - y2) * rate];\r\n                let pline = geometry.makePerpendicularLine(geometry.makeLine(lp, rp), [x0, y0]);\r\n                let d = geometry.pointLineDistance(bp, pline);\r\n                if (minDistance > d) {\r\n                    minDistance = d;\r\n                    minData = Object.assign({\r\n                        overturn: true,\r\n                        transform: this.computeTransform(\r\n                            [m.width - m.leftPoint[0], m.leftPoint[1]], [m.width - m.rightPoint[0], m.rightPoint[1]], [m.width - m.bottomPoint[0], m.bottomPoint[1]],\r\n                            lp, rp, geometry.getPerpendicularPoint(pline, bp),\r\n                            m.width, m.height)\r\n                    }, m);\r\n                }\r\n            }\r\n        });\r\n        return minData;\r\n    },\r\n    // 通过三点的起始坐标和终止坐标，计算平移、缩放和旋转（前提：sp1和sp2同高）\r\n    computeTransform(sp1, sp2, sp3, ep1, ep2, ep3, stickerWidth, stickerHeight) {\r\n        const de12 = geometry.pointDistance(ep1, ep2);\r\n        const xScale = de12 / geometry.pointDistance(sp1, sp2);\r\n        const yScale = geometry.pointLineDistance(ep3, geometry.makeLine(ep1, ep2)) / geometry.pointLineDistance(sp3, geometry.makeLine(sp1, sp2));\r\n        return {\r\n            xScale: xScale,\r\n            yScale: yScale,\r\n            centerX: (stickerWidth / 2 - sp1[0]) * xScale + ep1[0],\r\n            centerY: (stickerHeight / 2 - sp1[1]) * xScale + ep1[1],\r\n            angle: geometry.getAngle(ep1,\r\n                [ep1[0] + de12 * Math.sign(ep2[0] - ep1[0]), ep1[1]],\r\n                ep2)\r\n        }\r\n    },\r\n    // 戴口罩\r\n    wearAMaskAfterFaceDetection(result, canvasModel, realImgInfo) {\r\n        const points = result.landmarks.positions;\r\n        let leftPoint = geometry.getMidPoint(cvt(points[1]), cvt(points[2]));  // 左边缘\r\n        let rightPoint = geometry.getMidPoint(cvt(points[15]), cvt(points[14]));  // 右边缘\r\n        const bottomPoint = cvt(points[8]);  // 下边缘\r\n        const nosePoint = cvt(points[28]);  // 鼻\r\n        let side = 0;\r\n        // 判断鼻是否超过左右点\r\n        if (nosePoint.x > rightPoint.x) {\r\n            rightPoint = nosePoint;\r\n            side = 2;\r\n        } else if (nosePoint.x < leftPoint.x) {\r\n            leftPoint = nosePoint;\r\n            side = 1;\r\n        }\r\n        // 查找口罩\r\n        const maskInfo = {\r\n            mask: this.findMask(leftPoint, rightPoint, bottomPoint, side),\r\n            imgOriginalWidth: result.detection.imageWidth,\r\n            imgOriginalHeight: result.detection.imageHeight\r\n        }\r\n        return this.wearAMaskNormally(maskInfo, canvasModel, realImgInfo);\r\n    },\r\n    // 正常地戴口罩\r\n    wearAMaskNormally(maskInfo, canvasModel, realImgInfo) {\r\n        const mask = maskInfo.mask;\r\n        const xRate = realImgInfo.width / maskInfo.imgOriginalWidth;\r\n        const yRate = realImgInfo.height / maskInfo.imgOriginalHeight;\r\n        const stickerWidth = mask.width * mask.transform.xScale * (mask.overturn ? -1 : 1) * xRate;\r\n        this.getMaskImageSrc(mask, url => {\r\n            if (canvasModel.layers.length > 1) {\r\n                canvasModel.removeItem(1);\r\n            }\r\n            canvasModel.addPhoto(url, {\r\n                width: stickerWidth,\r\n                height: mask.height * mask.transform.yScale * yRate,\r\n                centerX: mask.transform.centerX * xRate + realImgInfo.position[0] - (mask.overturn ? stickerWidth : 0),\r\n                centerY: mask.transform.centerY * yRate + realImgInfo.position[1],\r\n                angle: mask.transform.angle\r\n            }, true);\r\n            canvasModel.chooseItem(1);\r\n        });\r\n        return maskInfo;\r\n    },\r\n    // 笨拙地戴口罩\r\n    wearAMaskAsAFool(canvasModel, realImgInfo) {\r\n        const mask = maskData.masks[2];\r\n        this.getMaskImageSrc(mask, url => {\r\n            if (canvasModel.layers.length > 1) {\r\n                canvasModel.removeItem(1);\r\n            }\r\n            canvasModel.addPhoto(url, {\r\n                width: realImgInfo.width / 4,\r\n                height: realImgInfo.height / 4,\r\n                centerX: canvasModel.width / 2,\r\n                centerY: canvasModel.height / 2,\r\n                angle: 0\r\n            }, true);\r\n            canvasModel.chooseItem(1);\r\n        });\r\n        return { mask };\r\n    },\r\n    // 重新戴口罩\r\n    resumeMask(maskInfo, canvasModel, realImgInfo) {\r\n        if (maskInfo.imgOriginalWidth) {\r\n            this.wearAMaskNormally(maskInfo, canvasModel, realImgInfo);\r\n        } else {\r\n            this.wearAMaskAsAFool(canvasModel, realImgInfo);\r\n        }\r\n    },\r\n    // 更换口罩\r\n    changeMask(newMask, canvasModel) {\r\n        const oldRect = canvasModel.layers[1].rect;\r\n        canvasModel.removeItem(1);\r\n        this.getMaskImageSrc(newMask, url => {\r\n            canvasModel.addPhoto(url, {\r\n                width: oldRect.width,\r\n                height: oldRect.height,\r\n                centerX: oldRect.center[0],\r\n                centerY: oldRect.center[1],\r\n                angle: oldRect.angle\r\n            }, true);\r\n            canvasModel.chooseItem(1);\r\n        });\r\n    },\r\n    // ajax获取口罩图片（防止canvas导出时报跨域的错）\r\n    getMaskImageSrc(mask, callback) {\r\n        if (this.maskImageSrc[mask.name]) {\r\n            callback(this.maskImageSrc[mask.name]);\r\n        } else {\r\n            const self = this;\r\n            const xhr = new XMLHttpRequest();\r\n            xhr.onload = function () {\r\n                const url = URL.createObjectURL(this.response);\r\n                self.maskImageSrc[mask.name] = url;\r\n                callback(url);\r\n            };\r\n            xhr.open('GET', maskData.baseUrl + mask.name, true);\r\n            xhr.responseType = 'blob';\r\n            xhr.send();\r\n        }\r\n    },\r\n}\r\n\r\n","/* eslint-disable no-console */\r\nimport * as faceapi from 'face-api.js';\r\nimport maskHelper from './maskHelper';\r\nimport urls from './urls';\r\n\r\nconst modelUrl = urls.modelBaseUrl;\r\n\r\nexport default {\r\n  detectPic(img, canvasModel, realImgInfo, callback, onFailed) {\r\n    let failed = false;\r\n    const onLoadErr = () => { failed = true; };\r\n    \r\n    // 加载训练好的模型(weight，bias)\r\n    // faceLandmark68Net 识别脸部特征用于mobilenet算法\r\n    // faceLandmark68TinyNet 识别脸部特征用于tiny算法\r\n    // ssdMobilenetv1 google开源AI算法除库包含分类和线性回归\r\n    // tinyFaceDetector 比Google的mobilenet更轻量级，速度更快一点\r\n    // mtcnn  多任务CNN算法\r\n    Promise.all([\r\n      faceapi.nets.faceLandmark68Net.loadFromUri(modelUrl).catch(onLoadErr),\r\n      faceapi.nets.faceLandmark68Net.loadFromUri(modelUrl).catch(onLoadErr),\r\n      //faceapi.nets.faceLandmark68TinyNet.loadFromUri(modelUrl).catch(onLoadErr),\r\n      faceapi.nets.ssdMobilenetv1.loadFromUri(modelUrl).catch(onLoadErr),\r\n      //faceapi.nets.tinyFaceDetector.loadFromUri(modelUrl).catch(onLoadErr),\r\n      //faceapi.nets.mtcnn.loadFromUri(modelUrl).catch(onLoadErr)\r\n    ]).then(async () => {\r\n      if (!failed) {\r\n        //设置需要使用什么算法和参数进行扫描识别图片的人脸特征\r\n        const options = new faceapi.SsdMobilenetv1Options({ minConfidence: 0.2 })\r\n        //const options = new faceapi.TinyFaceDetectorOptions({ inputSize: 160, scoreThreshold: 0.3})\r\n        //const options = new faceapi.MtcnnOptions()\r\n        let result = await faceapi.detectSingleFace(img, options).withFaceLandmarks()\r\n        console.log(result)\r\n        if (result) {\r\n          let maskInfo = maskHelper.wearAMaskAfterFaceDetection(result, canvasModel, realImgInfo);\r\n          // this.drawFaceLandmarks(canvasModel.canvas, [result], realImgInfo)\r\n          if (callback) {\r\n            callback(maskInfo);\r\n          }\r\n        } else if (onFailed) { onFailed('no result'); }\r\n      } else if (onFailed) { onFailed('no result'); }\r\n    });\r\n  },\r\n  drawFaceLandmarks(canvas, result, realImgInfo) {\r\n    let ctx = canvas.getContext(\"2d\");\r\n    result.forEach(e => {\r\n      let xRate = realImgInfo.width / e.detection.imageWidth;\r\n      let yRate = realImgInfo.height / e.detection.imageHeight;\r\n      e.landmarks.positions.forEach((e, i) => {\r\n        let x = e.x * xRate + realImgInfo.position[0];\r\n        let y = e.y * yRate + realImgInfo.position[1];\r\n        ctx.fillStyle=\"#0000FF\";\r\n        ctx.fillRect(x - 2, y - 2, 4, 4);\r\n        ctx.font = \"12px bold 宋体\";\r\n        ctx.fillText(i, x, y);\r\n      });\r\n    });\r\n  }\r\n}","/* eslint-disable no-console */\n\nconst getVectorLength = (v1, v2) => {\n    const [x1, y1] = v1;\n    const [x2, y2] = v2;\n    return (x1 * x2 + y1 * y2) / Math.sqrt(x1 * x1 + y1 * y1);\n};\n\nconst getDocPosition = (element) => {\n    let eleCom = element;\n    if (typeof element === 'string') eleCom = document.querySelector(eleCom);\n    let x = eleCom.offsetLeft;\n    let y = eleCom.offsetTop;\n    let parent = eleCom.offsetParent;\n    while (parent) {\n        x += parent.offsetLeft;\n        y += parent.offsetTop;\n        parent = parent.offsetParent;\n    }\n    return {\n        x,\n        y,\n    };\n};\n\n// 图片边框类\nclass Border {\n    /*\n    成员：\n    canvas  画布\n    rect  Rect对象，边框大小和位置\n    points  边框的四个顶点（左上角点、右上角点、右下角点、左下角点）\n    cPoints  边框的四个中点（左、上、右、下）\n    rPoint  边框的旋转点\n    */\n    constructor(canvas) {\n        this.canvas = canvas;\n    }\n    refresh(rect) {\n        this.rect = rect;\n        this.points = this.rect.points;\n        // 中点\n        this.cPoints = [];\n        this.points.reduce((a, b) => {\n            this.cPoints.push([(a[0] + b[0]) / 2, (a[1] + b[1]) / 2]);\n            return b;\n        }, this.points[3]);\n        // 旋转点\n        if (rect.height >= 0) {\n            this.rPoint = [(this.points[0][0] + this.points[1][0]) / 2,\n                this.points[0][1] - 35];\n        } else {\n            this.rPoint = [(this.points[2][0] + this.points[3][0]) / 2,\n                this.points[0][1] + 35];\n        }\n        this.draw();\n    }\n    draw() {\n        const {\n            points,\n            center,\n            angle,\n            width,\n            height,\n        } = this.rect;\n        const { context } = this.canvas;\n        const [c_x, c_y] = center;\n        context.save();\n        context.translate(c_x, c_y);\n        context.rotate(angle);\n        context.beginPath();\n        context.globalAlpha = 0.5;\n        context.lineWidth = '3';\n        context.strokeStyle = '#FF9999';\n        context.rect(points[0][0] - c_x,\n            points[0][1] - c_y,\n            width,\n            height);\n        context.moveTo((points[0][0] + points[1][0]) / 2 - c_x,\n            points[0][1] - c_y);\n        context.lineTo(this.rPoint[0] - c_x, this.rPoint[1] - c_y);\n        context.stroke();\n        context.closePath();\n        context.globalAlpha = 1;\n\n        const pointList = points.concat(this.cPoints);\n        pointList.forEach((item) => {\n            const [x, y] = item;\n            context.fillStyle = '#FF4949';\n            context.fillRect(x - 7 - c_x, y - 7 - c_y, 14, 14);\n        });\n        pointList.push(this.rPoint);\n        \n        context.beginPath();\n        context.strokeStyle = '#FF4949';\n        context.fillStyle = '#FF9999';\n        context.lineWidth = '5';\n        context.arc(this.rPoint[0] - c_x, this.rPoint[1] - c_y, 8, 0, Math.PI*2, true);\n        context.stroke();\n        context.closePath();\n        context.fill();\n\n        context.restore();\n    }\n    isPointInSkeletion(point) {\n        let status = null;\n        const [x, y] = point;\n        const { angle } = this.rect;\n        const r_point = this.rect.rotatePoint(this.rPoint, angle);\n        const d_point = this.points.map(item => this.rect.rotatePoint(item, angle));\n        const c_point = this.cPoints.map(item => this.rect.rotatePoint(item, angle));\n        // 旋转点\n        (() => {\n            const [c_x, c_y] = r_point;\n            if (Math.sqrt(Math.pow(c_x - x, 2) + Math.pow(c_y - y, 2)) < 10) {\n                status = 'r_point';\n            }\n        })();\n        d_point.forEach((item, index) => {\n            const [c_x, c_y] = item;\n            if (Math.sqrt(Math.pow(c_x - x, 2) + Math.pow(c_y - y, 2)) < 10) {\n                status = `point_${index + 1}`;\n            }\n        });\n        c_point.forEach((item, index) => {\n            const [c_x, c_y] = item;\n            if (Math.sqrt(Math.pow(c_x - x, 2) + Math.pow(c_y - y, 2)) < 10) {\n                status = `c_point_${index + 1}`;\n            }\n        });\n        return status;\n    }\n}\n\n// 矩形类\nclass Rect {\n    /*\n    成员：\n    width  宽\n    height  高\n    center  中心点\n    angle  旋转角度\n    points  左上角点、右上角点、右下角点、左下角点\n    */\n    constructor(width, height, center, angle) {\n        this.height = height;\n        this.width = width;\n        this.center = center;\n        this.angle = angle;\n        this.getPoints();\n    }\n    // 通过宽高和中点获取四个点\n    getPoints() {\n        const h = this.height;\n        const w = this.width;\n        const [c_x, c_y] = this.center;\n        const points = [];\n        points[0] = [c_x - w / 2, c_y - h / 2];\n        points[1] = [c_x + w / 2, c_y - h / 2];\n        points[2] = [c_x + w / 2, c_y + h / 2];\n        points[3] = [c_x - w / 2, c_y + h / 2];\n        this.points = points;\n    }\n    // 旋转\n    rotate(angle) {\n        this.angle = angle * Math.sign(this.height);\n    }\n    // 平移\n    translate(vector) {\n        const [_x, _y] = vector;\n        const points = this.points.map(item => [item[0] + _x, item[1] + _y]);\n        this.points = points;\n        this.getCenter();\n    }\n    // 缩放\n    zoom(status, vector) {\n        const _x = parseFloat(vector[0]);\n        const _y = parseFloat(vector[1]);\n        const _angle = this.angle;\n        // 旋转后的 x 轴相对于 canvas 的位置\n        let _x_x = Math.sin((_angle + Math.PI / 2));\n        let _y_x = Math.cos((_angle + Math.PI / 2));\n        // 如果角度为 0 特殊设置，因为有些 Math.cos 不兼容\n        if (_angle === 0) {\n            _x_x = 1;\n            _y_x = 0;\n        }\n        // 移动向量 vector 在旋转后 x 轴的距离\n        const n_x = getVectorLength([_x_x, _y_x], [_x, -_y]);\n\n        // 旋转后的 y 轴相对于 canvas 的位置\n        const _x_y = Math.sin(_angle) * 5;\n        const _y_y = Math.cos(_angle) * 5;\n        // 移动向量 vector 在旋转后 y 轴的距离\n        const n_y = getVectorLength([_x_y, _y_y], [_x, -_y]);\n\n        // 通过正切计算出顶点的角度\n        const tan = Math.atan(this.height / this.width);\n        // 通过移动顶点来缩放\n        const pointZoom = (_angles) => {\n            // 获取在第一个顶点上面的移动距离\n            const n_tan = getVectorLength([-Math.cos(_angles), Math.sin(_angles)], [_x, -_y]);\n            this.width += n_tan * Math.cos(tan);\n            this.height += n_tan * Math.sin(tan);\n            this.center = [\n                this.center[0] - n_tan * Math.cos(_angles) / 2,\n                this.center[1] - n_tan * Math.sin(_angles) / 2];\n        };\n        if (status === 'point_1') { // 第1个顶点\n            const _angles = tan + _angle;\n            pointZoom(_angles);\n        } else if (status === 'point_2') { // 第2个顶点\n            const _angles = Math.PI - tan + _angle;\n            pointZoom(_angles);\n        } else if (status === 'point_3') { // 第3个点\n            const _angles = Math.PI + tan + _angle;\n            pointZoom(_angles);\n        } else if (status === 'point_4') { // 第4个点\n            const _angles = 2 * Math.PI - tan + _angle;\n            pointZoom(_angles);\n        } else if (status === 'c_point_1') {\n            this.width -= n_x;\n            this.center = [\n                this.center[0] + n_x * Math.cos(_angle) / 2,\n                this.center[1] + n_x * Math.sin(_angle) / 2];\n        } else if (status === 'c_point_2') {\n            this.height += n_y;\n            this.center = [\n                this.center[0] + n_y * Math.sin(_angle) / 2,\n                this.center[1] - n_y * Math.cos(_angle) / 2];\n        } else if (status === 'c_point_3') {\n            this.width += n_x;\n            this.center = [\n                this.center[0] + n_x * Math.cos(_angle) / 2,\n                this.center[1] + n_x * Math.sin(_angle) / 2];\n        } else if (status === 'c_point_4') {\n            this.height -= n_y;\n            this.center = [\n                this.center[0] + n_y * Math.sin(_angle) / 2,\n                this.center[1] - n_y * Math.cos(_angle) / 2];\n        }\n        this.getPoints();\n        //this.setWH();\n    }\n    // 确定点是否在矩形内部\n    isPointInRect(point) {\n        // 旋转后的位置\n        const points = this.points.map(item => this.rotatePoint(item, this.angle));\n        const p1 = points[0];\n        const p2 = points[1];\n        const p3 = points[2];\n        const p4 = points[3];\n        const x = point[0];\n        const y = -point[1];\n        // 是否在两个平行线内\n        const ratio1 = (function () {\n            const a = (p1[1] - p2[1]) / (p2[0] - p1[0]);\n            const b = -p1[1] - a * p1[0];\n            const c = -p3[1] - a * p3[0];\n            if (b > c && a * x + b > y && a * x + c < y) return true;\n            if (b < c && a * x + b < y && a * x + c > y) return true;\n            return false;\n        }());\n        // 是否在两个平行线内\n        const ratio2 = (function () {\n            const a = (p2[1] - p3[1]) / (p3[0] - p2[0]);\n            const b = -p2[1] - a * p2[0];\n            const c = -p4[1] - a * p4[0];\n            if (p3[0] - p2[0] === 0) {\n                if ((p1[0] < x && x < p2[0]) || (p1[0] > x && x > p2[0])) return true;\n            }\n            if (b > c && a * x + b > y && a * x + c < y) return true;\n            if (b < c && a * x + b < y && a * x + c > y) return true;\n            return false;\n        }());\n        if (ratio1 && ratio2) return true;\n        return false;\n    }\n    // 获取中点\n    getCenter() {\n        const p1 = this.points[0];\n        const p3 = this.points[2];\n        const x = p1[0] + p3[0];\n        const y = p1[1] + p3[1];\n        this.center = [x / 2, y / 2];\n    }\n    // 某点绕中点旋转角度\n    rotatePoint(point, angle) {\n        const [x, y] = point;\n        const [c_x, c_y] = this.center;\n        const _x = (x - c_x) * Math.cos(angle) - (y - c_y) * Math.sin(angle) + c_x;\n        const _y = (x - c_x) * Math.sin(angle) + (y - c_y) * Math.cos(angle) + c_y;\n        return [_x, _y];\n    }\n    // 设置宽高\n    setWH() {\n        this.height = Math.abs(this.points[0][1] - this.points[3][1]);\n        this.width = Math.abs(this.points[0][0] - this.points[1][0]);\n    }\n}\n\n// 图片类\nclass Photo {\n    /*\n    成员：\n    canvas  容器\n    imgInput  图片对象或资源地址\n    image  图片对象\n    isLoad  是否已载入\n    onLoad  载入完成钩子\n    id  图片id\n    options  Photo对象\n    rect  Rect对象，代表图像位置\n    canEdit  图片是否可以编辑\n    */\n    constructor(image, canvas, onload = null, rect = null, canEdit = true) {\n        this.canvas = canvas;\n        this.imgInput = image;\n        this.image = null;\n        this.onLoad = onload;\n        this.rect = rect;\n        this.canEdit = canEdit;\n        this.id = new Date().getTime();\n        this.isLoad = false;\n        if (image instanceof Photo) {\n            this.options = image;\n            this.imgInput = this.options.imgInput;\n            this.id = this.options.id;\n        } else if (image instanceof Image) {\n            this.image = image;\n        }\n        this.prepare();\n    }\n    // 载入图片并初始化\n    prepare() {\n        if (typeof this.imgInput === 'string') {\n            this.image = new Image();\n            this.image.onload = () => {\n                if (this.isLoad) return;\n                this.isLoad = true;\n                this.init();\n            };\n            this.image.src = this.imgInput;\n            if (this.image.complete) {\n                this.isLoad = true;\n                this.init();\n            }\n        } else if (!this.image) {\n            this.image = this.imgInput;\n            this.isLoad = true;\n            this.init();\n        } else {\n            this.isLoad = true;\n            this.init();\n        }\n    }\n    // 初始化\n    init() {\n        if (this.onLoad) this.onLoad();\n        if (!this.rect) {\n            if (this.options) {\n                const {\n                    width, height, center, angle,\n                } = this.options.rect;\n                this.rect = new Rect(width,\n                    height, [center[0], center[1]], angle);\n            } else {\n                this.rect = new Rect(this.image.width,\n                    this.image.height, [this.canvas.width / 2, this.canvas.height / 2], 0);\n            }\n        }\n    }\n    // 绘制\n    draw() {\n        const { image, canvas, rect } = this;\n        const { context } = canvas;\n        const points = rect.points;\n        const [c_x, c_y] = rect.center;\n        context.save();\n        context.translate(c_x, c_y);\n        context.rotate(rect.angle);\n        context.scale(Math.sign(rect.width), Math.sign(rect.height))\n        context.drawImage(image, 0, 0, image.width, image.height,\n            points[0][0] - c_x,\n            points[0][1] - c_y,\n            rect.width,\n            rect.height);\n        context.restore();\n    }\n}\n\n// 画布类\nclass StickerCanvas {\n    /*\n    成员：\n    options  设置项\n    canvas  画布\n    width  画布的宽\n    height  画布的高\n    target  用来触发事件的元素(与canvas重合)\n    beforeLoading  数据载入之前的钩子\n    afterLoading  数据载入之后的钩子\n    data  绘制的数据\n    layers  画布的图层\n    context  canvas的上下文\n    border  活动图片的边框\n    current  当前图层\n    loadingLayerCount  正在载入的图层的个数\n    */\n    constructor(options) {\n        this.options = options;\n        const {\n            canvas,\n            height,\n            width,\n            target,\n            beforeLoading,\n            afterLoading,\n            data = []\n        } = this.options;\n        this.canvas = null;\n        this.height = height;\n        this.width = width;\n        this.target = target;\n        this.beforeLoading = beforeLoading;\n        this.afterLoading = afterLoading;\n        this.data = data;\n        this.layers = [];\n        if (typeof canvas === 'string') {\n            this.canvas = document.getElementById(canvas);\n        } else {\n            this.canvas = canvas;\n        }\n        if (typeof target === 'string') {\n            this.target = document.getElementById(target);\n        } else {\n            this.target = target;\n        }\n        this.canvas.width = width;\n        this.canvas.height = height;\n        this.context = this.canvas.getContext('2d');\n        this.loadingLayerCount = 0;\n        this.border = new Border(this);\n        this.current = null;\n        this.init();\n        this.initEvent();\n    }\n    // 初始化\n    init() {\n        this.clear();\n        if (this.beforeLoading) this.beforeLoading(this);\n\n        const add = (image) => {\n            this.loadingLayerCount += 1;\n            const lyr = new Photo(image, this, () => {\n                setTimeout(() => {\n                    this.loadingLayerCount -= 1;\n                    if (this.loadingLayerCount < 1) {\n                        this.draw();\n                    }\n                }, 100);\n            }, image.rect, image.canEdit);\n            this.layers.push(lyr);\n        };\n\n        // 恢复数据\n        this.data.forEach((item) => {\n            if (typeof item !== 'function') {\n                add(item);\n            }\n        });\n        if (this.afterLoading) this.afterLoading(this);\n    }\n    // 初始化事件响应\n    initEvent() {\n        this.target.addEventListener('mousedown', e => {\n            let p_x = e.pageX;\n            let p_y = e.pageY;\n            const position = getDocPosition(this.target);\n            const scale = this.width / this.target.offsetWidth;\n            const point = [\n                (p_x - position.x) * scale,\n                (p_y - position.y) * scale,\n            ];\n            const status = this.selectPhoto(point);\n            if (status) {\n                const move = (event) => {\n                    const m_x = event.pageX;\n                    const m_y = event.pageY;\n                    const vector = [(m_x - p_x) * scale, (m_y - p_y) * scale];\n                    if (status === 1) {\n                        this.current.rect.translate(vector);\n                    } else if (status === 'r_point') {\n                        const e_point = [(m_x - position.x) * scale, (m_y - position.y) * scale];\n                        const angle = StickerCanvas.getAngle(\n                            this.current.rect.center,\n                            this.border.rPoint,\n                            e_point,\n                        );\n                        if (!isNaN(angle)) {\n                            this.current.rect.rotate(angle);\n                        } else {\n                            return;\n                        }\n                    } else {\n                        this.current.rect.zoom(status, vector);\n                    }\n                    this.draw();\n                    p_x = m_x;\n                    p_y = m_y;\n                };\n                this.target.addEventListener('mousemove', move);\n                this.target.addEventListener('mouseup', () => {\n                    this.target.removeEventListener('mousemove', move);\n                });\n            }\n        });\n        this.target.addEventListener('touchstart', e => {\n            e.preventDefault();\n            let p_x = e.touches[0].pageX;\n            let p_y = e.touches[0].pageY;\n            const position = getDocPosition(this.target);\n            const scale = this.width / this.target.offsetWidth;\n            const point = [\n                (p_x - position.x) * scale,\n                (p_y - position.y) * scale,\n            ];\n            const status = this.selectPhoto(point);\n            if (status) {\n                const move = (event) => {\n                    const m_x = event.touches[0].pageX;\n                    const m_y = event.touches[0].pageY;\n                    const vector = [(m_x - p_x) * scale, (m_y - p_y) * scale];\n                    if (status === 1) {\n                        this.current.rect.translate(vector);\n                    } else if (status === 'r_point') {\n                        const e_point = [(m_x - position.x) * scale, (m_y - position.y) * scale];\n                        const angle = StickerCanvas.getAngle(\n                            this.current.rect.center,\n                            this.border.rPoint,\n                            e_point,\n                        );\n                        if (!isNaN(angle)) {\n                            this.current.rect.rotate(angle);\n                        } else {\n                            return;\n                        }\n                    } else {\n                        this.current.rect.zoom(status, vector);\n                    }\n                    this.draw();\n                    p_x = m_x;\n                    p_y = m_y;\n                };\n                this.target.addEventListener('touchmove', move);\n                this.target.addEventListener('touchend', () => {\n                    this.target.removeEventListener('touchmove', move);\n                });\n            }\n        });\n    }\n    // 旋转角度\n    static getAngle(cen, first, second) {\n        const f_c_x = first[0] - cen[0];\n        const f_c_y = cen[1] - first[1];\n        const s_c_x = second[0] - cen[0];\n        const s_c_y = cen[1] - second[1];\n        const c = Math.sqrt(f_c_x * f_c_x + f_c_y * f_c_y)\n            * Math.sqrt(s_c_x * s_c_x + s_c_y * s_c_y);\n        if (c === 0) return -1;\n        const angle = Math.acos((f_c_x * s_c_x + f_c_y * s_c_y) / c);\n        // 第一象限\n        if (cen[0] - second[0] < 0 && cen[1] - second[1] < 0) {\n            return angle;\n        }\n        // 第二象限\n        if (cen[0] - second[0] < 0 && cen[1] - second[1] > 0) {\n            return angle;\n        }\n        // 第三象限\n        if (cen[0] - second[0] > 0 && cen[1] - second[1] < 0) {\n            return 2 * Math.PI - angle;\n        }\n        // 第四象限\n        if (cen[0] - second[0] > 0 && cen[1] - second[1] > 0) {\n            return 2 * Math.PI - angle;\n        }\n        return null;\n    }\n    addCommand(command) {\n        this.layers.push(command);\n        if (this.loadingLayerCount > 0) {\n            setTimeout(() => {\n                this.draw();\n            }, 100);\n            return;\n        }\n        this.draw();\n    }\n    // 添加图片\n    addPhoto(image, rectOptions = null, canEdit = true) {\n        let rect = null;\n        if (rectOptions) {\n            rect = new Rect(rectOptions.width,\n                rectOptions.height,\n                [rectOptions.centerX, rectOptions.centerY],\n                rectOptions.angle);\n        }\n        if (typeof image === 'string') {\n            this.loadingLayerCount += 1;\n            const lyr = new Photo(image, this, () => {\n                setTimeout(() => {\n                    this.loadingLayerCount -= 1;\n                    if (this.loadingLayerCount < 1) {\n                        this.draw();\n                    }\n                }, 100);\n            }, rect, canEdit);\n            this.layers.push(lyr);\n        } else {\n            const lyr = new Photo(image, this, null, rect, canEdit);\n            this.layers.push(lyr);\n            this.draw();\n        }\n    }\n\n    selectPhoto(point) {\n        if (this.current) {\n            const status = this.border.isPointInSkeletion(point);\n            if (status) {\n                return status;\n            }\n        }\n        const layers = [].concat(this.layers)\n            .reverse();\n        this.current = null;\n        let c_index = 0;\n        layers.forEach((item, index) => {\n            if (typeof item !== 'function' && !this.current && item.rect.isPointInRect(point) && item.canEdit) {\n                this.current = item;\n                c_index = index + 1;\n            }\n        });\n        if (this.current) {\n            this.chooseItem(this.layers.length - c_index);\n            return 1;\n        } else {\n            this.draw();\n        }\n        return 0;\n    }\n\n    chooseItem(index) {\n        if (this.layers[index].canEdit) {\n            this.current = this.layers[index];\n            this.layers.splice(index, 1);\n            this.layers.push(this.current);\n            this.draw();\n        }\n    }\n\n    removeItem(index) {\n        this.layers.splice(index, 1);\n        this.draw();\n    }\n\n    // 将当前画布的图像导出为png\n    export() {\n        const canvas = document.createElement('canvas');\n\n        const bg = this.layers[0];\n        canvas.width = bg.image.width;\n        canvas.height = bg.image.height;\n        const context = canvas.getContext('2d');\n        context.drawImage(bg.image, 0, 0, bg.image.width, bg.image.height,\n            0, 0, canvas.width, canvas.height);\n        const xRate = bg.image.width / bg.rect.width;\n        const yRate = bg.image.height / bg.rect.height;\n        const xOffset = bg.rect.center[0] - bg.rect.width / 2;\n        const yOffset = bg.rect.center[1] - bg.rect.height / 2;\n        \n        if (this.layers[1]) {\n            const fg = this.layers[1];\n            const points = fg.rect.points;\n            let [c_x, c_y] = fg.rect.center;\n            c_x = (c_x - xOffset) * xRate;\n            c_y = (c_y - yOffset) * yRate;\n            context.save();\n            context.translate(c_x, c_y);\n            context.rotate(fg.rect.angle);\n            context.scale(Math.sign(fg.rect.width), Math.sign(fg.rect.height))\n            context.drawImage(fg.image, 0, 0, fg.image.width, fg.image.height,\n                (points[0][0] - xOffset) * xRate - c_x,\n                (points[0][1] - yOffset) * yRate - c_y,\n                fg.rect.width * xRate,\n                fg.rect.height * yRate);\n            context.restore();\n        }\n        \n        return canvas.toDataURL(\"image/png\");\n    }\n\n    // 清理画布\n    clear() {\n        // Store the current transformation matrix\n        this.context.save();\n        // Use the identity matrix while clearing the canvas\n        this.context.setTransform(1, 0, 0, 1, 0, 0);\n        this.context.clearRect(0, 0, this.width, this.height);\n        // Restore the transform\n        this.context.restore();\n    }\n    save() {\n        const data = this.layers.map((item) => {\n            const { rect, id, img } = item;\n            return { rect, id, img };\n        });\n       return data;\n    }\n    draw() {\n        this.clear();\n        this.layers.forEach(item => {\n            if (typeof item === 'function') {\n                item.apply(null, this.context, this.canvas);\n            } else {\n                item.draw();\n            }\n        });\n        if (this.current) {\n            this.border.refresh(this.current.rect);\n        }\n    }\n}\nexport default StickerCanvas;\n","<template>\n  <div id=\"editor\" ref=\"editor\">\n    <div id=\"editorUI\" :class=\"{'loading': loading}\">\n      <div ref=\"canvasContainer\">\n      </div>\n      <button id=\"resumeBtn\" @click=\"resumeMask\">重置</button>\n      <div id=\"maskStore\" ref=\"maskStore\">\n        <p class=\"title\">更换口罩</p>\n        <div class=\"list\">\n          <ul>\n            <li v-for=\"m in maskData.masks\" :key=\"m.name\" @click=\"changeMask(m)\">\n              <img :src=\"maskData.baseUrl + m.name\">\n            </li>\n          </ul>\n        </div>\n      </div>\n      <div class=\"control\" ref=\"control\">\n        <button id=\"reuploadBtn\" @click=\"reupload\">重选图片</button>\n        <button id=\"saveBtn\" @click=\"save\">保存图片</button>\n      </div>\n    </div>\n    <div v-if=\"loading\" id=\"loading\">\n      <div>\n        <p>\n          <b>正在进行人脸检测，请稍等……</b>\n          <br>\n          由于算法全程在浏览器运行，\n          <br>\n          运算速度可能取决于设备性能。\n        </p>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n/* eslint-disable no-console */\nimport faceApiUtil from '../utils/faceApiUtil';\nimport StickerCanvas from '../utils/stickerCanvas';\nimport maskData from '../utils/maskData';\nimport maskHelper from '../utils/maskHelper';\n\nexport default {\n  props: {\n    fileId: Number\n  },\n  data() {\n    return {\n      currentFileId: 0,\n      editor: null,\n      canvas: null,\n      maskData: maskData,\n      maskInfo: null,\n      realImgInfo: null,\n      loading: false\n    }\n  },\n  methods: {\n    loadImg(file) {\n      if (this.canvas) {\n        this.canvas.remove();\n      }\n      this.canvas = document.createElement('canvas');\n      this.canvas.width = this.$refs.editor.clientWidth;\n      this.canvas.height = this.$refs.editor.clientHeight - this.$refs.maskStore.clientHeight - this.$refs.control.clientHeight;\n      this.$refs.canvasContainer.appendChild(this.canvas);\n      this.editor = new StickerCanvas({\n        canvas: this.canvas,\n        target: this.canvas,\n        width: this.canvas.width,\n        height: this.canvas.height\n      });\n      const editor = this.editor;\n      const self = this;\n      const reader = new FileReader();\n      reader.readAsDataURL(file);  // 发起异步请求\n      reader.onload = function () {\n        const img = new Image();\n        img.src = this.result;\n        img.onload = function () {\n          // 等比例缩放图片\n          const xRate = editor.width / img.width;\n          const yRate = editor.height / img.height;\n          const setRate = xRate < yRate ? xRate : yRate;\n          const imgWidth = img.width * setRate;\n          const imgHeight = img.height * setRate;\n          const imgX = (editor.width - imgWidth) / 2;\n          const imgY = (editor.height - imgHeight) / 2;\n          editor.addPhoto(img, {\n            width: imgWidth,\n            height: imgHeight,\n            centerX: editor.width / 2,\n            centerY: editor.height / 2,\n            angle: 0\n          }, false);\n          self.realImgInfo = {\n            width: imgWidth,\n            height: imgHeight,\n            position: [imgX, imgY]\n          };\n          self.loading = true;\n          faceApiUtil.detectPic(img, editor, self.realImgInfo, maskInfo => {\n            self.maskInfo = maskInfo;\n            self.loading = false;\n          }, e => {\n            console.log(e);\n            self.maskInfo = maskHelper.wearAMaskAsAFool(self.editor, self.realImgInfo);\n            self.loading = false;\n          });\n        }\n      }\n    },\n    resumeMask () {\n      if (this.maskInfo && this.editor) {\n        maskHelper.resumeMask(this.maskInfo, this.editor, this.realImgInfo);\n      }\n    },\n    changeMask (m) {\n      if (this.maskInfo && this.editor) {\n        maskHelper.changeMask(m, this.editor);\n      }\n    },\n    reupload () {\n      this.$emit('navTo', 'index');\n    },\n    save () {\n      this.$store.commit('setEditor', this.editor);\n      this.$emit('navTo', 'export');\n    }\n  },\n  watch: {\n    fileId (v) {\n      if (v != this.currentFileId && this.$store.state.userImgInfo && v == this.$store.state.userImgInfo.id) {\n        this.loadImg(this.$store.state.userImgInfo.file);\n        this.currentFileId = v;\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n#editor, #editorUI {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n#maskStore {\n  position: absolute;\n  width: 100%;\n  bottom: 60px;\n  background: #f3b8b1;\n}\n#maskStore .title {\n  background: #ff664d;\n  color: white;\n  height: 30px;\n  line-height: 30px;\n}\n#maskStore .list {\n  overflow-x: auto;\n  overflow-y: hidden;\n  height: 90px;\n}\n#maskStore ul {\n  width: auto;\n  white-space: nowrap;\n}\n#maskStore li {\n  position: relative;\n  width: 80px;\n  height: 80px;\n  font-size: 14px;\n  display: inline-block;\n  margin: 5px;\n  padding: 5px;\n  text-align: center;\n  vertical-align: middle;\n}\n#maskStore li:hover {\n  border: 1px dashed #666;\n  border-radius: 5px;\n}\n#maskStore img {\n  position: relative;\n  width: 100%;\n  vertical-align: middle;\n}\n.control {\n  position: absolute;\n  width: 100%;\n  bottom: 0px;\n  height: 60px;\n  background: #ff664d;\n}\n.control button {\n  width: 120px;\n  height: 40px;\n  margin: 10px;\n  background: white;\n  border-radius: 20px;\n  appearance: none;\n  border: none;\n  font-size: 16px;\n  box-shadow: 0px 0px 5px #888;\n}\nbutton:hover {\n  background: #f5dcd9;\n}\n#resumeBtn {\n  position: absolute;\n  top: 0px;\n  right: 0px;\n  width: 60px;\n  height: 25px;\n  margin: 10px;\n  background: white;\n  border-radius: 13px;\n  appearance: none;\n  border: none;\n  font-size: 14px;\n  box-shadow: 0px 0px 5px #ccc;\n  opacity: 0.6;\n}\n#editorUI.loading {\n  filter: blur(20px);\n}\n#loading {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0px;\n}\n#loading > div {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 280px;\n  height: 94px;\n  padding: 10px;\n  margin: -47px 0px 0px -140px;\n  background: white;\n  border-radius: 5px;\n  font-size: 16px;\n  line-height: 25px;\n  box-shadow: 0px 0px 10px #ccc;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Editor.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Editor.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Editor.vue?vue&type=template&id=d357fdec&scoped=true&\"\nimport script from \"./Editor.vue?vue&type=script&lang=js&\"\nexport * from \"./Editor.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Editor.vue?vue&type=style&index=0&id=d357fdec&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"d357fdec\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"export\"}},[_c('div',{class:{'loading': _vm.loading},attrs:{\"id\":\"exportUI\"}},[_c('p',{ref:\"ic\",staticClass:\"img-container\"},[_c('img',{style:(_vm.imgStyle),attrs:{\"src\":_vm.imgUrl,\"load\":_vm.loading=false}})]),_c('div',{ref:\"title\",staticClass:\"title\"},[_c('p',[_vm._v(\"长按或右键保存下方图片\")]),_c('div',{staticClass:\"control\"},[_c('button',{on:{\"click\":_vm.backToEditor}},[_vm._v(\"继续编辑\")]),_c('button',{on:{\"click\":_vm.backToIndex}},[_vm._v(\"重选图片\")])])])]),(_vm.loading)?_c('div',{attrs:{\"id\":\"loading\"}},[_vm._m(0)]):_vm._e()])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('p',[_c('b',[_vm._v(\"正在导出中……\")])])])}]\n\nexport { render, staticRenderFns }","<template>\n  <div id=\"export\">\n    <div id=\"exportUI\" :class=\"{'loading': loading}\">\n      <p class=\"img-container\" ref=\"ic\"><img :src=\"imgUrl\" :style=\"imgStyle\" :load=\"loading=false\"></p>\n      <div class=\"title\" ref=\"title\">\n        <p>长按或右键保存下方图片</p>\n        <div class=\"control\">\n          <button @click=\"backToEditor\">继续编辑</button>\n          <button @click=\"backToIndex\">重选图片</button>\n        </div>\n      </div>\n    </div>\n    <div v-if=\"loading\" id=\"loading\">\n      <div>\n        <p>\n          <b>正在导出中……</b>\n        </p>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\n/* eslint-disable no-console */\n\nexport default {\n  data() {\n    return {\n      imgUrl: '',\n      imgStyle: {},\n      loading: true\n    }\n  },\n  methods: {\n    backToIndex () {\n      this.$emit('navTo', 'index');\n    },\n    backToEditor () {\n      this.$emit('navTo', 'editor');\n    }\n  },\n  created () {\n    if (!this.$store.state.editor) {\n      this.$emit('navTo', 'index');\n    }\n  },\n  mounted () {\n    const cw = this.$refs.ic.clientWidth;\n    const ch = this.$refs.ic.clientHeight - this.$refs.title.clientHeight;\n    const iw = this.$store.state.editor.layers[0].image.width;\n    const ih = this.$store.state.editor.layers[0].image.height;\n    const xRate = cw / iw;\n    const yRate = ch / ih;\n    const setRate = xRate < yRate ? xRate : yRate;\n    const imgWidth = iw * setRate;\n    const imgHeight = ih * setRate;\n    const imgX = (cw - imgWidth) / 2;\n    const imgY = (ch - imgHeight) / 2 + this.$refs.title.clientHeight;\n    this.imgStyle = {\n      width: imgWidth + 'px',\n      height: imgHeight + 'px',\n      left: imgX + 'px',\n      top: imgY + 'px'\n    }\n    this.imgUrl = this.$store.state.editor.export()\n  }\n}\n</script>\n\n<style scoped>\n#export, #exportUI {\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.title {\n  position: absolute;\n  width: 100%;\n  height: 90px;\n  top: 0px;\n  background: #ff664d;\n}\n.title p {\n  color: white;\n  line-height: 30px;\n}\n.img-container {\n  height: 100%;\n  position: relative;\n}\nimg {\n  display: block;\n  position: absolute;\n}\n.control {\n  width: 100%;\n  height: 60px;\n  background: #ffbbb4;\n}\nbutton {\n  width: 120px;\n  height: 40px;\n  margin: 10px;\n  background: white;\n  border-radius: 20px;\n  appearance: none;\n  border: none;\n  font-size: 16px;\n  box-shadow: 0px 0px 5px #888;\n}\nbutton:hover {\n  background: #f5dcd9;\n}\n#exportUI.loading {\n  filter: blur(20px);\n}\n#loading {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0px;\n}\n#loading > div {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  width: 200px;\n  height: 50px;\n  padding: 10px;\n  margin: -25px 0px 0px -100px;\n  background: white;\n  border-radius: 5px;\n  font-size: 16px;\n  line-height: 30px;\n  box-shadow: 0px 0px 10px #ccc;\n}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Export.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Export.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Export.vue?vue&type=template&id=1272cf90&scoped=true&\"\nimport script from \"./Export.vue?vue&type=script&lang=js&\"\nexport * from \"./Export.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Export.vue?vue&type=style&index=0&id=1272cf90&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1272cf90\",\n  null\n  \n)\n\nexport default component.exports","<template>\n  <div id=\"app\">\n    <div id=\"header\">\n      <img id=\"logo\" src=\"./assets/logo-title.svg\">\n      <a id=\"forkMe\" href=\"https://github.com/zamhown/wear-a-mask\">Fork me on GitHub!</a>\n    </div>\n    <div id=\"contentContainer\">\n      <div id=\"content\">\n        <Index v-show=\"nav=='index'\" @navTo=\"navTo\" />\n        <Editor v-show=\"nav=='editor'\" :fileId=\"currentFileId\" @navTo=\"navTo\" />\n        <Export v-if=\"nav=='export'\" @navTo=\"navTo\" />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport Index from './components/Index.vue'\nimport Editor from './components/Editor.vue'\nimport Export from './components/Export.vue'\n\nexport default {\n  name: 'app',\n  components: {\n    Index,\n    Editor,\n    Export\n  },\n  data() {\n    return {\n      nav: 'index',\n      currentFileId: 0\n    }\n  },\n  methods: {\n    navTo(where, data) {\n      this.nav = where;\n      if (data) {\n        this.currentFileId = data;\n      }\n    }\n  }\n}\n</script>\n\n<style>\n* {\n  box-sizing: border-box;\n  user-select: none;\n}\nhtml, body, p, ul, li {\n  margin: 0;\n  padding: 0;\n}\n#app {\n  font-family: 'Avenir', Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  background: white;\n  color: #2c3e50;\n}\n#header, #contentContainer {\n  max-width: 600px;\n}\n#header {\n  position: relative;\n  height: 25vh;\n  margin: 0px auto;\n}\n#logo {\n  height: 100%;\n}\n#forkMe {\n  display: block;\n  position: absolute;\n  top: 0px;\n  right: 20px;\n  background: #f2bb43;\n  color: white;\n  text-decoration: none;\n  font-size: 14px;\n  line-height: 14px;\n  font-family: 'Times New Roman', Times, serif;\n  padding: 8px 15px;\n  border-radius: 0px 0px 20px 20px;\n  box-shadow: 0px 0px 10px #ccc;\n}\n#contentContainer {\n  position: relative;\n  height: 75vh;\n  margin: 0px auto;\n  padding: 0px 15px 15px 15px;\n}\n#content {\n  height: 100%;\n  border: 2px solid #ff9c92;\n  border-radius: 5px;\n  box-shadow: 0px 0px 5px #ccc;\n  overflow-y: auto;\n  overflow-x: hidden;\n}\n</style>\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=0b265970&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Vue from 'vue'\r\nimport Vuex from 'vuex'\r\n\r\nVue.use(Vuex)\r\n\r\n// initial state\r\nconst state = {\r\n  userImgInfo: null,\r\n  editor: null\r\n}\r\n\r\n// getters\r\nconst getters = {}\r\n\r\n// actions\r\nconst actions = {}\r\n\r\n// mutations\r\nconst mutations = {\r\n  setUserImgInfo (state, data) {\r\n    state.userImgInfo = data\r\n  },\r\n  setEditor (state, data) {\r\n    state.editor = data\r\n  }\r\n}\r\n\r\nexport default new Vuex.Store({\r\n  state,\r\n  getters,\r\n  actions,\r\n  mutations\r\n})\r\n","import Vue from 'vue'\nimport App from './App.vue'\nimport store from './store'\n\nVue.config.productionTip = false\n\nnew Vue({\n  store,\n  render: h => h(App),\n}).$mount('#app')\n","module.exports = __webpack_public_path__ + \"img/example.bcb76468.png\";","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Export.vue?vue&type=style&index=0&id=1272cf90&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Export.vue?vue&type=style&index=0&id=1272cf90&scoped=true&lang=css&\"","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Index.vue?vue&type=style&index=0&id=410321b3&scoped=true&lang=css&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Index.vue?vue&type=style&index=0&id=410321b3&scoped=true&lang=css&\""],"sourceRoot":""}